@using System.Web.Optimization
@model RecipeEditor.Models.RecipeModel
@{
    ViewBag.Title = @Model.Title;
}
<div id="Recipe">
	<h1>@Model.Title</h1>
	<div class="columnRight">
		<h3>Kategorien</h3>
		<ul>
			@foreach(var category in Model.Categories)
			{
				<li>@category</li>
			}
		</ul>
		<h2>Zutaten</h2>
		@foreach(var component in Model.Components)
		{
			<h3>@component.Title</h3>
			<table>
				@foreach (var ingredient in component.Ingredients)
				{
					<tr>
						@if (ingredient.Quantity != null)
						{
							<td>@ingredient.Quantity.Amount</td>
							<td>@ingredient.Quantity.Unit</td>
						}
						else
						{
							<td></td>
							<td></td>
						}
						<td><a href="@ingredient.Ingredient.Url">@ingredient.Ingredient.Name</a></td>
					</tr>
				}
			</table>
		}
	</div>    
	<div class="columnLeft">
		<img class="photo" src="@if (Model.Image != null) {@Model.Image.Url} else {<text>~/Content/icons/tango/32x32/status/image-missing.png</text>}" alt="recipe"/>
		@if (Model.Image != null) { <div>Foto von @Model.Image.Author</div>	}
		<h2>Zubereitung</h2>
		@foreach(var component in Model.Components)
		{
			<h3>@component.Title</h3>
			<div>@Html.Raw(component.Preparation)</div>
		}
		<button type="button" onclick="InitRecipeEditor()">bearbeiten</button>
	</div>
</div>
<form action="#" id="RecipeEditor" data-bind="with: data" style="display: none;">
    <h1 data-bind="text: Title"></h1>
	<div class="columnRight">
		<h3>Kategorien</h3>
		<ul data-bind="foreach: Categories">
			<li data-bind="text: $data"></li>
		</ul>
		<h2>Zutaten</h2>
		<!-- ko foreach: Components -->
		<h3 data-bind="text: Title"></h3>
		<button type="button" class="edit">
			<img alt="list-remove" src="~/Content/icons/tango/16x16/actions/list-remove.png" />
		</button>
		<table data-bind="foreach: Ingredients">
			<tr>
				<!-- ko if: Quantity -->
				<td data-bind="text:Quantity().Amount"></td>
				<td data-bind="text:Quantity().Unit"></td>
				<!-- /ko -->
				<!-- ko ifnot: Quantity -->
				<td></td>
				<td></td>
				<!-- /ko -->
				<td><a data-bind="text:Ingredient().Name, attr: {href: Ingredient().Url}"></a></td>
			</tr>
		</table>
		<!-- /ko -->
		<button type="button" class="edit">
			<img alt="list-add" src="~/Content/icons/tango/16x16/actions/list-add.png" />
		</button>
	</div>
	<div class="columnLeft">
		<img class="photo" alt="recipe" data-bind="attr: {src: Image.Url}" />
		<div>Foto von <!--ko text: Image.Author--><!--/ko--></div>
		<h2>Zubereitung</h2>
		<!-- ko foreach: Components -->
		<h3 data-bind="text: Title"></h3>
		<div class="contentEditableToolbar edit">
			<button type="button" data-bind="event: { click: onFormatBold }">
				<img src="~/Content/icons/tango/22x22/actions/format-text-bold.png" /></button>
			<button type="button" data-bind="event: { click: onFormatItalic }">
				<img src="~/Content/icons/tango/22x22/actions/format-text-italic.png" /></button>
			<button type="button" data-bind="event: { click: onUndo }">
				<img src="~/Content/icons/tango/22x22/actions/edit-undo.png" /></button>
			<button type="button" data-bind="event: { click: onRedo }">
				<img src="~/Content/icons/tango/22x22/actions/edit-redo.png" /></button>
		</div>
		<div contenteditable="true" data-bind="html: Preparation, event: {change: onUpdatePreparation}">
		</div>
		<!-- /ko -->
		<button type="button" class="edit" onclick="HideRecipeEditor();">vorschau</button>
		<button type="button" class="preview" onclick="ShowRecipeEditor();">bearbeiten</button>
		<button type="button" data-bind="event: {click: $parent.onRevert}">
			<img alt="revert" src="~/Content/icons/tango/16x16/actions/edit-undo.png" />
		</button>
		<button type="button" data-bind="event: {click: $parent.onSave}">
			<img alt="save" src="~/Content/icons/tango/16x16/actions/document-save.png" />
		</button>
	</div>
</form>
@Scripts.Render("~/Scripts/recipe")
<script type="text/javascript">
InitRecipeViewModel(@Html.Raw(Model.Json));
</script>
